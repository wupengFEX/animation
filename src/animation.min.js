(function(global){var TAG="#";var unitCache={};var VENDOR=["","webkit","moz","ms","o","Webkit","Moz","O"];var UNIT_REG=/^\d+([a-zA-Z]+)/;var cVendor;function judgeVendor(){if(cVendor){return}var prop="transition";var ele=document.createElement("virtualDom");for(var key in VENDOR){var vendor=VENDOR[key]+prop.charAt(0).toUpperCase()+prop.slice(1);if(vendor in ele.style){cVendor=VENDOR[key];break}}}function isFunction(fn){return typeof fn==="function"}function isString(str){return Object.prototype.toString.call(str)==="[object String]"}function toFloat(num){num=parseFloat(num);return !isNaN(num)?num:0}function isEmptyObject(e){if(Object.prototype.toString.call(e)!=="[object Object]"){return true}for(var t in e){return false}return true}function isHashTag(tag){return tag===TAG?true:false}function needAnimation(item){var flag=false;var style=getComputedStyle(item.ele);for(var key in item.property){if(item.property[key]!==style[key]){flag=true;break}}if(!flag&&item.fn){item.fn()}return flag}function unitProperty(property,value,ele){if(value!==+value){return value}if(unitCache[property]){return value+unitCache[property]}ele.style[property]=0;var propValue=ele.style[property];var match=propValue.match&&propValue.match(UNIT_REG);if(match){return value+(unitCache[property]=match[1])}return value}function setVendorProperty(prop,fn){var ele=document.createElement("virtualDom");var newProp=prop;if(!(prop in ele.style)){newProp=!cVendor?cVendor:cVendor+prop.charAt(0).toUpperCase()+prop.slice(1)}fn(prop,newProp)}function calculateProperty(ele,property,opt){var cb;opt=opt?opt:{};for(var k in opt){if(isFunction(opt[k])){cb=opt[k];break}}return{fn:cb,ele:ele,property:property,duration:toFloat(opt.duration)?toFloat(opt.duration)/1000:0.4,easing:isString(opt.easing)?opt.easing:"linear",isAsync:toFloat(opt.isAsync)?toFloat(opt.isAsync):0,delay:toFloat(opt.delay)?toFloat(opt.delay)/1000:0}}function AnimationElement(){this.isRuning=false;this.queue=[];this.endCb=[]}AnimationElement.prototype._setAnimationTimeout=function(funRef,ele,delayTime){var obj={};obj.target=ele.ele;var bindFun=funRef.bind(this,obj,ele);ele.bindFun=bindFun;ele.timer=setTimeout(bindFun,delayTime)};AnimationElement.prototype._startRun=function(isExexuteNow){if(!this.isRuning&&isExexuteNow&&this.queue.length>0){this.isRuning=true;this._run()}};AnimationElement.prototype._run=function(){if(this.queue.length===0){return}for(var i=0;i<this.queue.length;i++){if(!isHashTag(this.queue[i])){if(needAnimation(this.queue[i])){this._addVendorEvent(this.queue[i],"transitionend");var outTime=this.queue[i].duration*1000+this.queue[i].delay*1000+25;this._setAnimationTimeout(this._handle,this.queue[i],outTime);this.queue[i].startTime=new Date().getTime();setVendorProperty("transition",function(oldProp,newProp){this.queue[i].ele.style[newProp]="all ".concat(this.queue[i].duration,"s ",this.queue[i].easing," ",this.queue[i].delay,"s")}.bind(this));for(var j in this.queue[i].property){this.queue[i].ele.style[j]=this.queue[i].property[j]}}else{this.queue.splice(i,1);if(isHashTag(this.queue[0])){this.isRuning=false;this.queue.shift()}this._run()}}else{break}}};AnimationElement.prototype._handle=function(event,obj){var now=new Date().getTime();if((now-obj.startTime)/1000>=obj.duration+obj.delay){this.isRuning=false;clearTimeout(obj.timer);this._removeVendorEvent(obj,"transitionend");var isAsync=this._deleteFinishElement(obj);if(isHashTag(this.queue[0])){if(isAsync){if(!!this.endCb[0]&&Object.prototype.toString.call(this.endCb[0])==="[object Function]"){this.endCb[0]()}this.endCb.shift()}this.queue.shift();this._startRun(1)}}};AnimationElement.prototype._addVendorEvent=function(el,prop){var obj={};obj.target=el.ele;var bindFun=this._handle.bind(this,obj,el);setVendorProperty(prop,function(oldProp,newProp){prop=newProp});el.ele.addEventListener(prop,bindFun);el.bindFun=bindFun};AnimationElement.prototype._removeVendorEvent=function(el,prop){setVendorProperty(prop,function(oldProp,newProp){prop=newProp});el.ele.removeEventListener(prop,el.bindFun)};AnimationElement.prototype._deleteFinishElement=function(ele){for(var i=0;i<this.queue.length;i++){var currentAnimationDom=this.queue[i];if(currentAnimationDom!==TAG&&this.queue[i]===ele){if(!!this.queue[i].fn){this.queue[i].fn()}var deleteNode=this.queue.splice(i,1);return deleteNode[0].isAsync}}return 0};AnimationElement.prototype._setInitializateProperty=function(propsObj){var ele=document.createElement("virtualDom");for(var key in propsObj){setVendorProperty(key,function(oldProp,newProp){if(newProp!==oldProp){propsObj[newProp]=propsObj[oldProp];delete propsObj[oldProp]}});var props=unitProperty(key,propsObj[key],ele);propsObj[key]=props}};AnimationElement.prototype._pushDoms=function(ele,prop,opt){var currentObj;if(ele.length>0){for(var i=0;i<ele.length;i++){if(ele[i] instanceof HTMLElement){opt.isAsync=1;this._pushToAsyncQueue(ele[i],prop,opt)}}}else{if(ele instanceof HTMLElement){this._pushToAsyncQueue(ele,prop,opt)}}};AnimationElement.prototype._pushToAsyncQueue=function(ele,prop,opt){var obj=calculateProperty(ele,prop,opt);
obj.isAsync?this.queue.push(obj):this.queue.push(obj,TAG)};AnimationElement.prototype.animate=function(ele,property,opt){if(!ele||isEmptyObject(property)){return this}this._setInitializateProperty(property);this._pushDoms(ele,property,opt);return this};AnimationElement.prototype.start=function(fn){if(this.queue.length===0){return}this.endCb.push(fn);if(!isHashTag(this.queue[this.queue.length-1])){this.queue.push(TAG)}if(!this.isRuning){this._startRun(1)}return this};AnimationElement.prototype.stop=function(){this.isRuning=false;for(var i=0;i<this.queue.length;i++){var asycEvent=this.queue[i];if(!isHashTag(this.queue[i])){clearTimeout(asycEvent.timer);var style=getComputedStyle(asycEvent.ele);this._removeVendorEvent(asycEvent,"transitionend");setVendorProperty("transitionDuration",function(oldProp,newProp){asycEvent.ele.style[newProp]="0s"});for(var j in asycEvent.property){asycEvent.ele.style[j]=style[j]}}}this.queue=[];return this};function AnimationEntry(ele,property,opt){var animate=new AnimationElement();judgeVendor();animate.animate(ele,property,opt);return animate}global.animate=AnimationEntry})(this);